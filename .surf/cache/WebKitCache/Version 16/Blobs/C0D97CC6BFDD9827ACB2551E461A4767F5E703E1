"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_assets_modules_react-code-view_components_blob-edit_WebCommitDialog_tsx"],{20925:(e,t,r)=>{r.r(t),r.d(t,{default:()=>F});var a,s,n,i,o,l,c=r(85893),d=r(70479),u=r(88455),h=r(64077),p=r(68203),g=r(89445),x=r(85529),m=r(42483),f=r(88216),b=r(75578),j=r(51526),y=r(13503),Z=r(73290),v=r(56397),w=r(5359),P=r(98833),C=r(97011),k=r(43535),N=r(67294);r(57852);var _=r(17791);function R({suggestionsUrlIssue:e,suggestionsUrlMention:t,suggestionsUrlEmoji:r,value:a,setValue:s,sx:n,textareaProps:i}){let o=(0,N.useRef)(null),l=(0,N.useRef)(null),d=(0,N.useCallback)(()=>{s(l.current?.value||a)},[s,a]);return(0,N.useEffect)(()=>{let e=o.current;return e?.addEventListener("text-expander-committed",d),()=>{e?.removeEventListener("text-expander-committed",d)}},[d]),(0,c.jsx)(m.Z,{sx:{position:"relative",...n},children:(0,c.jsx)("text-expander",{keys:": @ #","data-issue-url":e,"data-mention-url":t,"data-emoji-url":r,ref:o,children:(0,c.jsx)(_.ZP,{onChange:e=>s(e.target.value),onKeyDown:e=>{("Enter"===e.code||"Tab"===e.code&&l.current?.value!==a)&&e.stopPropagation()},ref:l,value:a,sx:{width:"100%"},...i})})})}try{R.displayName||(R.displayName="TextExpander")}catch{}var I=r(64071),B=r(31360),T=r(31174),E=r(49713),q=r(75809),L=r(51461),M=r(89042),z=r(21913);function S({branch:e,protectionNotEnforcedInfo:t}){let r=t.upsellCtaInfo.cta,a=t.organization,{branchProtected:s,rulesetsProtected:n}=t,{showUpgradeButton:i,askAdmin:o,rulesetsUpsell:l,ctaPath:d}=r;function u(e,t,r){return e?(0,c.jsx)(Z.Z,{href:r,...(0,q.f)("linked-text"),underline:!0,children:t}):t}return(0,c.jsxs)(L.Z,{variant:"warning",sx:{alignItems:"flex-start",display:"flex",flexDirection:"column",mt:2,mb:3},children:[(0,c.jsx)(()=>{function r({branchProtectionPath:t}){return(0,c.jsxs)(m.Z,{...(0,q.f)("pb-org"),children:[(0,c.jsx)(P.Z,{icon:x.AlertIcon}),"Your ",u(!o,"protected branch rules",t)," ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you upgrade this organization to a GitHub Team or Enterprise account."]})}function i({branchProtectionPath:t}){return(0,c.jsxs)(m.Z,{...(0,q.f)("pb-personal"),children:[(0,c.jsx)(P.Z,{icon:x.AlertIcon}),"Your ",u(!o,"protected branch rules",t)," ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you move to a GitHub Team or Enterprise account."]})}return l?a?s&&!n?(0,c.jsx)(r,{branchProtectionPath:t.editRepositoryBranchesPath}):(0,c.jsx)(function({rulesetsPath:t}){return(0,c.jsxs)(m.Z,{...(0,q.f)("ru-org"),children:[(0,c.jsx)(P.Z,{icon:x.AlertIcon}),"The ",u(!o,"rulesets",t)," targeting your ",(0,c.jsx)("strong",{children:e}),o?" branch won't be enforced on this private repository until your organization admins upgrade this organization account to GitHub Team.":" branch won't be enforced on this private repository until you upgrade this organization to GitHub Team."]})},{rulesetsPath:t.editRepositoryRulesetsPath}):s&&!n?(0,c.jsx)(i,{branchProtectionPath:t.editRepositoryBranchesPath}):(0,c.jsx)(function({rulesetsPath:t}){return(0,c.jsxs)(m.Z,{...(0,q.f)("ru-personal"),children:[(0,c.jsx)(P.Z,{icon:x.AlertIcon}),"The ",u(!o,"rulesets",t)," targeting your ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you move to a GitHub Team organization account."]})},{rulesetsPath:t.editRepositoryRulesetsPath}):a?(0,c.jsx)(r,{branchProtectionPath:t.editRepositoryBranchesPath}):(0,c.jsx)(i,{branchProtectionPath:t.editRepositoryBranchesPath})},{}),i&&(0,c.jsx)(M.Q,{...(0,q.f)("Upgrade-Btn"),href:d,sx:{mt:2,...z.A},children:"Upgrade"}),(0,c.jsx)(m.Z,{sx:{mt:2},children:(0,c.jsx)(E.g6,{featureRequestInfo:t.featureRequestInfo,requestedMessage:"You've successfully submitted a request to your organization's admins for this feature."})})]})}try{S.displayName||(S.displayName="BranchProtectionNotEnforcedBanner")}catch{}try{(a=BannerMessage).displayName||(a.displayName="BannerMessage")}catch{}try{(s=ProtectedBranchOrganizationMessage).displayName||(s.displayName="ProtectedBranchOrganizationMessage")}catch{}try{(n=ProtectedBranchPersonalMessage).displayName||(n.displayName="ProtectedBranchPersonalMessage")}catch{}try{(i=RulesetsUpsellPersonalMessage).displayName||(i.displayName="RulesetsUpsellPersonalMessage")}catch{}try{(o=RulesetUpsellOrganizationMessage).displayName||(o.displayName="RulesetUpsellOrganizationMessage")}catch{}try{(l=LinkToIf).displayName||(l.displayName="LinkToIf")}catch{}function F({content:e,contentChanged:t,fileName:r,isDelete:a,isNewFile:s,helpUrl:n,oldPath:i,ownerName:o,placeholderMessage:l,refName:_,webCommitInfo:E,dialogState:q,setDialogState:L,setSecretDetected:M,setSecretBypassMetadata:z}){let{authorEmails:F,canCommitStatus:U,commitOid:W,dcoSignoffEnabled:A,dcoSignoffHelpUrl:D,defaultEmail:H,defaultNewBranchName:G,forkedRepo:O,guidanceTask:V,pr:Y,repoHeadEmpty:$,saveUrl:Q,suggestionsUrlEmoji:K,suggestionsUrlIssue:X,suggestionsUrlMention:J}=E,ee=(0,u.F)(Q,a?"delete":"post"),et=(0,p.s)(),[er,ea]=N.useState(l),[es,en]=N.useState(""),[ei,eo]=N.useState("allowed"!==U||!!O),[el,ec]=N.useState(G),[ed,eu]=N.useState(F.length?H:void 0),eh="saving"===q,[ep,eg]=N.useState(""),[ex,em]=N.useState(),ef=(0,B.T)(),{submitCommitDialogShortcut:eb}=(0,T.bx)(),ej=(0,I.QV)(),ey=N.useRef(null);(0,N.useEffect)(()=>{ey.current&&ey.current.focus()},[]);let eZ=N.useRef(!1),ev=ei?"Propose changes":"Commit changes";A&&(ev=`Sign off and ${ev.toLocaleLowerCase()}`);let ew=!O&&!$,eP=async()=>{let n;L("saving");let c=O?`${o}:${_}`:_,d={message:er,placeholder_message:l,description:es,author_email:ed??void 0,"commit-choice":ew?ei?"quick-pull":"direct":void 0,target_branch:ew?ei?el:_:void 0,quick_pull:ei?c:"",guidance_task:V??"",commit:W,same_repo:O||$?void 0:1,pr:Y??""};n=a?{...d,_method:"delete"}:{...d,content_changed:t,filename:s?r:i,new_filename:r,value:e};let u=new FormData;for(let[e,t]of Object.entries(n))void 0!==t&&u.set(e,t);u.append("authenticity_token",ee??"");try{let e=await (0,g.Q)(Q,{method:"post",body:u,headers:{Accept:"application/json"}}),t=await e.json();if(t.data.redirect){let e=t.data.redirect,r=e.startsWith(window.location.origin)?e.replace(window.location.origin,""):e;(0,h.F)(),ef.current=!0,t.data.message&&ej({message:t.data.message,variant:"default"}),L("saved"),setTimeout(()=>{et(r)},50);return}t.data.error&&t.data.secretBypassMetadata?(M&&M(!0),z?.(t.data.secretBypassMetadata),L("closed")):t.data.error?(L("pending"),eg(t.data.error),t.data.error_details&&em(t.data.error_details)):(eg("File could not be edited"),L("pending"))}catch(e){eg("File could not be edited"),L("pending")}},eC=F.filter(e=>e),ek="allowed"===U||ei?"primary":"danger",eN="can_bypass"!==U||ei?ev:"Bypass rules and commit changes";return(0,c.jsxs)(k.V,{"aria-labelledby":"web-commit-dialog-header",onClose:()=>{eZ.current||L("closed")},sx:{overflowY:"auto"},title:ev,width:"large",renderFooter:()=>(0,c.jsxs)(m.Z,{sx:{borderTop:"1px solid",borderColor:"border.default",display:"flex",justifyContent:"flex-end",flexWrap:"wrap-reverse",gap:2,padding:3},children:[(0,c.jsx)(f.r,{onClick:()=>{L("closed")},children:"Cancel"}),(0,c.jsx)(f.r,{onClick:eP,disabled:eh,variant:ek,"data-hotkey":eb.hotkey,children:eh?"Saving...":eN})]}),children:[(0,c.jsx)(d.g,{prefix:"There was an error committing your changes:",errorMessageUsingPrefix:ep,ruleErrors:ex?.ruleViolations,helpUrl:n}),(0,c.jsxs)(m.Z,{as:"form",onSubmit:e=>{eP(),e.preventDefault()},children:[(0,c.jsxs)(b.Z,{children:[(0,c.jsx)(b.Z.Label,{children:"Commit message"}),(0,c.jsx)(j.Z,{onChange:e=>ea(e.target.value),placeholder:l,value:er,ref:ey,sx:{width:"100%",mb:3}})]}),(0,c.jsxs)(b.Z,{children:[(0,c.jsx)(b.Z.Label,{children:"Extended description"}),(0,c.jsx)(R,{suggestionsUrlIssue:X,suggestionsUrlMention:J,suggestionsUrlEmoji:K,value:es,setValue:en,sx:{width:"100%",mb:3},textareaProps:{placeholder:"Add an optional extended description..",onCompositionStart:()=>eZ.current=!0,onCompositionEnd:()=>eZ.current=!1}})]}),eC.length>1?(0,c.jsxs)(b.Z,{sx:{mb:3},children:[(0,c.jsx)(b.Z.Label,{children:"Commit Email"}),(0,c.jsx)(y.Z,{onChange:e=>{eu(e.target.value)},defaultValue:H,children:F.map((e,t)=>(0,c.jsx)(y.Z.Option,{value:e,children:e},t))}),A&&(0,c.jsxs)(b.Z.Caption,{children:["Choose an email address for"," ",(0,c.jsx)(Z.Z,{href:D,target:"_blank",rel:"noreferrer",underline:!0,children:"signing off"})," ","on this commit"]})]}):A?(0,c.jsxs)(m.Z,{sx:{mb:3},children:["You are"," ",(0,c.jsx)(Z.Z,{href:D,target:"_blank",rel:"noreferrer",underline:!0,children:"signing off"})," ","on this commit as ",H]}):null,E.protectionNotEnforcedInfo?.upsellCtaInfo.visible&&(0,c.jsx)(S,{branch:_,protectionNotEnforcedInfo:E.protectionNotEnforcedInfo}),ew&&(0,c.jsxs)(v.Z,{name:"pr-choice",onChange:e=>{eo("pr"===e)},children:[(0,c.jsx)(v.Z.Label,{visuallyHidden:!0,children:"Direct commit or PR"}),(0,c.jsxs)(b.Z,{children:["blocked"!==U&&(0,c.jsx)(w.Z,{"aria-checked":!ei,"aria-describedby":"can_bypass"!==U||ei?void 0:"bypass-warning",value:"direct",defaultChecked:!ei}),(0,c.jsx)(b.Z.Label,{sx:{fontWeight:"normal"},children:"blocked"!==U?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.Z,{children:["Commit directly to the"," ",(0,c.jsx)(m.Z,{as:"pre",sx:{display:"inline"},children:_})," ","branch"]}),"can_bypass"===U&&!ei&&(0,c.jsxs)(m.Z,{sx:{display:"flex",alignItems:"center",marginTop:1},children:[(0,c.jsx)(P.Z,{size:12,icon:x.AlertFillIcon,sx:{color:"danger.fg",marginRight:1}}),(0,c.jsx)(C.Z,{id:"bypass-warning",role:"status",sx:{color:"danger.fg",fontSize:0},children:"Some rules will be bypassed by committing directly"})]})]}):(0,c.jsxs)(c.Fragment,{children:["You can\u2019t commit to"," ",(0,c.jsx)(m.Z,{as:"pre",sx:{display:"inline"},children:_})," ","because it is a"," ",(0,c.jsx)(Z.Z,{href:`${n}/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests`,underline:!0,children:"protected branch"})]})})]}),(0,c.jsxs)(b.Z,{children:[(0,c.jsx)(w.Z,{"aria-checked":ei,value:"pr",defaultChecked:ei}),(0,c.jsxs)(b.Z.Label,{sx:{fontWeight:"normal"},children:["Create a ",(0,c.jsx)("strong",{children:"new branch"})," for this commit and start a pull request"," ",(0,c.jsx)(m.Z,{children:(0,c.jsx)(Z.Z,{href:`${n}/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests`,sx:{fontSize:0},children:"Learn more about pull requests"})})]})]}),ei&&(0,c.jsx)(m.Z,{sx:{mt:3,mx:3},children:(0,c.jsx)(j.Z,{"aria-label":"PR target branch","aria-details":el?void 0:"Please enter a branch name",leadingVisual:x.GitPullRequestIcon,onChange:e=>ec(e.target.value),placeholder:G,sx:{width:"100%"},value:el})})]})]})]})}try{F.displayName||(F.displayName="WebCommitDialog")}catch{}},70479:(e,t,r)=>{r.d(t,{g:()=>d});var a=r(85893),s=r(85529),n=r(51461),i=r(42483),o=r(73290),l=r(98833),c=r(93062);function d({prefix:e,errorMessageUsingPrefix:t,errorMessageNotUsingPrefix:r,ruleErrors:d,helpUrl:u}){let h=(d?.length||0)>0;return t||r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Z,{variant:"danger",className:"d-flex flex-items-center flex-justify-between",sx:{marginBottom:3},children:t?(0,a.jsxs)(i.Z,{children:[e," ",(0,a.jsx)(c.WZ,{sx:{fontWeight:"bold"},unverifiedHTML:t}),h&&(0,a.jsx)(o.Z,{href:`${u}/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/about-rulesets`,sx:{marginLeft:1},children:"Learn more about rulesets."})]}):r&&(0,a.jsx)(i.Z,{children:r})}),h&&(0,a.jsxs)(i.Z,{sx:{marginBottom:3},children:[(0,a.jsx)(i.Z,{sx:{fontWeight:"bold",marginBottom:1},children:"Repository rule violations found:"}),d?.map(e=>a.jsxs(i.Z,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(l.Z,{icon:s.XCircleFillIcon,size:16,sx:{color:"danger.fg"}}),a.jsx(i.Z,{sx:{marginLeft:2},children:e})]},e))]})]}):null}try{d.displayName||(d.displayName="FlashError")}catch{}}}]);
//# sourceMappingURL=app_assets_modules_react-code-view_components_blob-edit_WebCommitDialog_tsx-ef44e9dccc50.js.map